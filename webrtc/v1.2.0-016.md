# network

v1.2.0版本的其他依赖包全都分析完了，最后一个就是network，
在这个包中将其他底层细节全部封装了，如果说rtcp包是开味菜，
那这个包就是大餐，需要慢慢品味，最大的还是webrtc包和demo带来的思考。

## 回顾

先将之前单独分析的过程做一个回顾，因为network将她们全部联系在一起了

### dtls

dtls, 这个库在pion/dtls，v1.2.0中并没有分析这个的源码,后面再分析源码

### datachannel

datachannel支持两种数据：open/ack，分别用于请求开启datachannel和相应的应答。

- 对外暴露一个Message的接口，用来表示这种消息。
- 对外暴露一个DataChannel，表示datachannel对象
  - 这个对象对外提供了创建服务端/客户端的datachannel对象的接口
  - 客户端对象会自动发送open，服务端对象收到后会自动发送ack
  - 这个对象最重要的是对外提供了读写功能

底层sctp协议相关的都被隐藏了

### mux

mux是为了将接收套接字进行复用

- 对外暴露Mux数据结构，表示对接收套接字的封装
  - 利用endpoint的注册监听来实现将接收消息进行分发,整个分发过程都是自动的
- 对外暴露Endpoint数据结构
  - 不同的协议利用这个数据结构进行网络读写

### sctp

用于提供datachannel底层的网络传输

- 对外暴露Association，表示一个sctp连接
  - 提供了创建服务端/客户端对象的构造函数
  - Association会有多个流，所以对外也暴露了打开Steam的接口
- 对外暴露了Stream,表示sctp中的一个连接
  - 对外提供了读写功能

这个包还提供了各种sctp格式的信息,因为是粗略分析，所以没有深入，
至少没有rtcp包分析的深入

这个包构造Association对象时，需要外部传入一个net.Conn参数

### srtp

提升了rtp的安全性，里面包含了对rtp/rtcp的加密解密

- 对外提供了一个Context结构体，表示了加密上下文
  - 对外提供了构造函数
  - 对外提供了对rtp/rtcp的加密解密

### ice

实现了本地ice/公网ice的收集和协商

- 对外暴露一个Agent结构体，表示ice连接的一端
  - 暴露了构造函数，入参是stun/turn地址和ice连接状态监听函数(允许外部监听)
  - 通过这个对象，可添加远端ice候选，收集本地ice候选，获取ice匹配信息(帐号密码)
  - 对外提供了Conn的构造函数
- 对外提供了Conn结构体，Conn就是将Agent封装了一下，对外暴露读写功能
  - 对外暴露读写
  - 里面走的是udp，连接自己维护

### rtcp

rtcp对外暴露一个Packet的接口，并实现了多种rtcp包：
sr/rr/sdes/bye/tln/rrr/pli/sli/和默认rtcp报文

### rtp

实现了rtp包和字符串之间的序列化和反序列化,其中也包含定制部分：

- 切片逻辑
- 序号起始

这些都是通过构造函数NewPacketizer()创建一个打包器来实现的
