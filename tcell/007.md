# mouse demo分析

mouse demo提供了更多绘制的细节和绘制的约束

这个demo主要提供的功能是就是用鼠标画矩形,
很多操作都设计成阻塞式(eg:窗口大小改变),
不像之前的box和color是在改变时实时变化,
mouse中的是等待操作结束后,一次性绘制.

整个demo的运行分两个阶段:准备阶段和运行阶段.

## 准备阶段

- 字符编码
  - 和box/color不同,mouse直接支持所有编码
  - 这样就不需要指定备用编码了
  - 做法也很简单,只要在Screen初始化时能找到编码即可
- screen的构造和初始化
  - 包括风格的设置,黑底白字,支持鼠标
- 画笔1(某种风格),红底白字

这里除了字符编码的全部支持,没有新的api

## 运行阶段

### 提示框

在for循环的开头,有这么一段:

- 画一个矩形
- 画4个字符串
- 绘制出来

这样做的好处:

- 这个矩形永远不会被覆盖(给人的感觉就是窗口前置)
- 这个矩形适合放一些常用信息,比如使用手册

先看下画矩形边框的步骤:

- 通过两个坐标点确定一个矩形范围
- 画左右两边/上下两边/4个拐角的图形
- 画线框内部的元素(程序中指定的的同一个字符)

画字符串就比较简单,计算不出宽度的用空格代替,
其他的直接绘制在指定位置.

最后调用tScreen.Show()将画布显示在终端上.

在事件处理之前,还定义两个画笔:
红底和蓝底黑字.

### 事件处理

mouse中主要处理3类事件:

- 窗口大小改变
- 键盘
- 鼠标
- 其他
  - 右下脚会显示X

窗口大小改变的处理:
除了窗口重绘,还在右下脚画出了一个R,红底白字的那种.

键盘事件的处理:

- Esc两次,会退出程序
- Ctrl+L, 强制刷新
- 其他按键,会重置Esc的按键次数,如果是c,清屏

对于鼠标事件:
在说起鼠标事件前,先聊一下跟鼠标相关的事:

- 在提示框中,显示了几条信息
  - 其中第二条和第三条分别是鼠标位置和鼠标按下的类型
- 和鼠标相关的有3种坐标
  - mx/my, 当前光标所在的坐标(包括了鼠标的按下和释放)
  - bx/by, 鼠标按键下,光标对应的坐标
  - ox/oy, 在鼠标按下切移动的过程中,表示鼠标按下时的坐标

整个运行阶段,除了画提示框,还有个写法非常有意思:

- 画提示框
- 选中部分颜色衰减(也就是颜色还原)
- 事件处理
- 选中部分高亮

通过一次颜色还原和高亮,保证在事件处理时不受选中的影响.

下面来重点看下事件处理部分的鼠标事件:

- 不管是何种鼠标事件,都会在提示框中显示鼠标事件的种类
- 如果是选中且事件是释放时,重绘选中区域
- 如果是非滚轮鼠标事件,右下脚显示M
- 最后如果有选中,那将选中部分高亮

最后,回顾一下整个demo,功能很简单:
有个提示框来展示操作,可以用鼠标来画矩形,
矩形的颜色和文字随着不同的鼠标按键而不同.
如果还要说一点:就是滚轮按键的信息会呈现在提示框中.

对于写法:悬浮式的提示框,选中区域的颜色如何变化,
都是很值得借鉴的想法.
